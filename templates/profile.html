{% extends 'base.html' %}

{% block title %}Mon Profil - STINS{% endblock %}

{% block styles %}
<style>
    /* Base Styles - Exactement comme dans index.html */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: #0f0f0f;
        color: #ffffff;
    }

    .container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    a {
        text-decoration: none;
        color: #ffffff;
        transition: color 0.3s;
    }

    button {
        cursor: pointer;
        border: none;
        outline: none;
    }

    /* Navbar */
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 50px;
        background-color: rgba(20, 20, 20, 0.8);
        backdrop-filter: blur(10px);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
    }

    .logo a {
        font-size: 24px;
        font-weight: 700;
        color: #0d9668;
    }

    .nav-links {
        display: flex;
        gap: 30px;
    }

    .nav-links a {
        color: #ffffff;
        font-size: 14px;
        opacity: 0.8;
        transition: opacity 0.3s;
    }

    .nav-links a:hover {
        opacity: 1;
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .search-icon {
        font-size: 18px;
        opacity: 0.8;
        cursor: pointer;
        transition: opacity 0.3s;
    }

    .search-icon:hover {
        opacity: 1;
    }

    .profile-link, .logout-link {
        font-size: 14px;
        font-weight: 500;
        color: #ffffff;
        opacity: 0.9;
        transition: opacity 0.3s;
    }

    .profile-link:hover, .logout-link:hover {
        opacity: 1;
    }

    .sign-in {
        font-size: 14px;
        font-weight: 500;
        color: #ffffff;
        opacity: 0.9;
        transition: opacity 0.3s;
    }

    .sign-in:hover {
        opacity: 1;
    }

    .search-form {
        display: flex;
    }
    
    .search-input {
        padding: 8px 12px;
        border-radius: 4px 0 0 4px;
        border: none;
        background-color: rgba(255, 255, 255, 0.1);
        color: #ffffff;
    }
    
    .search-btn {
        padding: 8px 12px;
        border-radius: 0 4px 4px 0;
        border: none;
        background-color: #10b981;
        color: white;
        cursor: pointer;
    }

    /* Footer */
    footer {
        background-color: #141414;
        padding: 50px;
    }

    .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
    }

    .footer-column h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .footer-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .footer-links a {
        font-size: 14px;
        color: #bfbfbf;
        transition: color 0.3s;
    }

    .footer-links a:hover {
        color: #ffffff;
    }

    .footer-bottom {
        border-top: 1px solid #262626;
        padding-top: 20px;
        font-size: 12px;
        color: #999999;
    }

    /* Styles spécifiques à la page de profil */
    .profile-container {
        padding: 100px 50px 50px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .profile-header {
        margin-bottom: 30px;
    }

    .profile-header h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .profile-header p {
        font-size: 16px;
        color: #bfbfbf;
    }

    .profile-content {
        display: flex;
        gap: 30px;
    }

    .profile-sidebar {
        width: 280px;
        background-color: #1a1a1a;
        border-radius: 8px;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: #262626;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 40px;
        color: #10b981;
    }

    .profile-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
        text-align: center;
    }

    .profile-email {
        font-size: 14px;
        color: #bfbfbf;
        margin-bottom: 30px;
        text-align: center;
    }

    .profile-menu {
        width: 100%;
        list-style: none;
    }

    .profile-menu-item {
        margin-bottom: 10px;
    }

    .profile-menu-link {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        border-radius: 4px;
        transition: background-color 0.3s;
    }

    .profile-menu-link:hover {
        background-color: #262626;
    }

    .profile-menu-link.active {
        background-color: #10b981;
        color: white;
    }

    .profile-menu-link i {
        width: 20px;
        text-align: center;
    }

    .profile-main {
        flex-grow: 1;
        background-color: #1a1a1a;
        border-radius: 8px;
        padding: 30px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .tab-title {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 30px;
    }

    .profile-form {
        max-width: 600px;
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 20px;
        width: 100%;
    }

    .form-group label {
        display: block;
        font-size: 14px;
        margin-bottom: 8px;
    }

    .input-with-icon {
        position: relative;
        display: flex;
        align-items: center;
    }

    .input-with-icon i {
        position: absolute;
        left: 15px;
        color: #bfbfbf;
    }

    .input-with-icon input {
        width: 100%;
        padding: 12px 15px 12px 40px;
        background-color: #262626;
        border: none;
        border-radius: 4px;
        color: #ffffff;
        font-size: 14px;
    }

    .toggle-password {
        position: absolute;
        right: 15px;
        background: none;
        border: none;
        color: #bfbfbf;
        cursor: pointer;
    }

    .profile-button {
        background-color: #10b981;
        color: white;
        padding: 12px 24px;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
        border: none;
    }

    .profile-button:hover {
        background-color: #0d9668;
    }

    .error-message, .success-message {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    .error-message {
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .success-message {
        background-color: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    /* Styles pour l'onglet Abonnement */
    .subscription-info {
        background-color: #262626;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .subscription-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .subscription-name {
        font-size: 18px;
        font-weight: 600;
    }

    .subscription-status {
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 600;
    }

    .subscription-status.active {
        background-color: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .subscription-status.expired {
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .subscription-details {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .subscription-detail {
        flex: 1;
    }

    .detail-label {
        font-size: 12px;
        color: #bfbfbf;
        margin-bottom: 5px;
    }

    .detail-value {
        font-size: 14px;
        font-weight: 600;
    }

    .subscription-features {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .subscription-feature {
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .subscription-feature i {
        color: #10b981;
    }

    .subscription-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .subscription-option {
        background-color: #262626;
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: transform 0.3s, border-color 0.3s;
        border: 2px solid transparent;
    }

    .subscription-option:hover {
        transform: translateY(-5px);
    }

    .subscription-option.selected {
        border-color: #10b981;
    }

    .subscription-option-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .subscription-option-price {
        font-size: 24px;
        font-weight: 700;
        color: #10b981;
    }

    .subscription-option-period {
        font-size: 14px;
        color: #bfbfbf;
        margin-bottom: 15px;
    }

    .subscription-option-features {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .subscription-option-feature {
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .subscription-option-feature i {
        color: #10b981;
    }

    /* Styles pour l'onglet Historique */
    .history-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .history-item {
        display: flex;
        align-items: center;
        gap: 15px;
        background-color: #262626;
        border-radius: 8px;
        padding: 15px;
    }

    .history-thumbnail {
        width: 100px;
        height: 60px;
        border-radius: 4px;
        overflow: hidden;
    }

    .history-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .history-details {
        flex-grow: 1;
    }

    .history-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .history-meta {
        font-size: 14px;
        color: #bfbfbf;
        display: flex;
        gap: 15px;
    }

    .history-actions {
        display: flex;
        gap: 10px;
    }

    .history-action {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #1a1a1a;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s;
        border: none;
    }

    .history-action:hover {
        background-color: #10b981;
    }

    /* Styles pour l'onglet Ma liste */
    .watchlist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 20px;
    }

    .watchlist-item {
        background-color: #262626;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
    }

    .watchlist-poster {
        width: 100%;
        aspect-ratio: 2/3;
    }

    .watchlist-poster img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .watchlist-title {
        padding: 10px;
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .watchlist-year {
        padding: 0 10px 10px;
        font-size: 12px;
        color: #bfbfbf;
    }

    .watchlist-remove {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .watchlist-remove:hover {
        background-color: #ef4444;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .profile-container {
            padding: 100px 30px 30px;
        }
    }

    @media (max-width: 768px) {
        .profile-container {
            padding: 80px 20px 20px;
        }
        
        .profile-content {
            flex-direction: column;
        }
        
        .profile-sidebar {
            width: 100%;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .subscription-details {
            flex-direction: column;
            gap: 10px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>Mon profil</h1>
        <p>Gérez vos informations personnelles et vos préférences</p>
    </div>
    
    <div class="profile-content">
        <div class="profile-sidebar">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-name">{{ user.first_name }} {{ user.last_name }}</div>
            <div class="profile-email">{{ user.email }}</div>
            
            <ul class="profile-menu">
                <li class="profile-menu-item">
                    <a href="#" class="profile-menu-link active" data-tab="account">
                        <i class="fas fa-user-circle"></i>
                        <span>Compte</span>
                    </a>
                </li>
                <li class="profile-menu-item">
                    <a href="#" class="profile-menu-link" data-tab="subscription">
                        <i class="fas fa-credit-card"></i>
                        <span>Abonnement</span>
                    </a>
                </li>
                <li class="profile-menu-item">
                    <a href="#" class="profile-menu-link" data-tab="history">
                        <i class="fas fa-history"></i>
                        <span>Historique</span>
                    </a>
                </li>
                <li class="profile-menu-item">
                    <a href="#" class="profile-menu-link" data-tab="watchlist">
                        <i class="fas fa-bookmark"></i>
                        <span>Ma liste</span>
                    </a>
                </li>
                <li class="profile-menu-item">
                    <a href="#" class="profile-menu-link" data-tab="security">
                        <i class="fas fa-lock"></i>
                        <span>Sécurité</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="profile-main">
            <!-- Onglet Compte -->
            <div id="account" class="tab-content active">
                <h2 class="tab-title">Informations du compte</h2>
                
                <form id="account-form" class="profile-form">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name">Prénom</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" placeholder="Prénom">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="last_name">Nom</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" placeholder="Nom">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="username">Nom d'utilisateur</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user-circle"></i>
                            <input type="text" id="username" name="username" value="{{ user.username }}" placeholder="Nom d'utilisateur">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="email" name="email" value="{{ user.email }}" placeholder="Email">
                        </div>
                    </div>
                    
                    <div class="error-message" id="account-error"></div>
                    <div class="success-message" id="account-success"></div>
                    
                    <button type="submit" class="profile-button">Enregistrer les modifications</button>
                </form>
            </div>
            
            <!-- Onglet Abonnement -->
            <div id="subscription" class="tab-content">
                <h2 class="tab-title">Mon abonnement</h2>
                
                <div class="subscription-info">
                    <div class="subscription-header">
                        <div class="subscription-name">{{ user.profile.get_subscription_type_display }}</div>
                        <div class="subscription-status {% if user.profile.is_subscription_active %}active{% else %}expired{% endif %}">
                            {% if user.profile.is_subscription_active %}Actif{% else %}Expiré{% endif %}
                        </div>
                    </div>
                    
                    <div class="subscription-details">
                        <div class="subscription-detail">
                            <div class="detail-label">Date de début</div>
                            <div class="detail-value">{{ user.profile.subscription_start|date:"d/m/Y" }}</div>
                        </div>
                        
                        <div class="subscription-detail">
                            <div class="detail-label">Date d'expiration</div>
                            <div class="detail-value">{{ user.profile.subscription_expiry|date:"d/m/Y" }}</div>
                        </div>
                        
                        <div class="subscription-detail">
                            <div class="detail-label">Prochain paiement</div>
                            <div class="detail-value">{{ user.profile.next_payment_date|date:"d/m/Y" }}</div>
                        </div>
                    </div>
                    
                    <div class="subscription-features">
                        {% if user.profile.subscription_type == 'basic' %}
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Accès à une sélection de films
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Qualité standard
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> 1 écran à la fois
                            </div>
                        {% elif user.profile.subscription_type == 'standard' %}
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Accès à plus de films
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Qualité HD
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> 2 écrans à la fois
                            </div>
                        {% elif user.profile.subscription_type == 'premium' %}
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Accès à tous les films
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Qualité 4K + HDR
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> 4 écrans à la fois
                            </div>
                            <div class="subscription-feature">
                                <i class="fas fa-check"></i> Téléchargements hors ligne
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <h3>Changer d'abonnement</h3>
                
                <form id="subscription-form" class="profile-form">
                    {% csrf_token %}
                    <div class="subscription-options">
                        <!-- Option Basic -->
                        <div class="subscription-option {% if user.profile.subscription_type == 'basic' %}selected{% endif %}" data-plan="basic">
                            <div class="subscription-option-name">Basic</div>
                            <div class="subscription-option-price">$4.99</div>
                            <div class="subscription-option-period">par mois</div>
                            <div class="subscription-option-features">
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Accès à une sélection de films
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Qualité standard
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> 1 écran à la fois
                                </div>
                            </div>
                        </div>
                        
                        <!-- Option Standard -->
                        <div class="subscription-option {% if user.profile.subscription_type == 'standard' %}selected{% endif %}" data-plan="standard">
                            <div class="subscription-option-name">Standard</div>
                            <div class="subscription-option-price">$9.99</div>
                            <div class="subscription-option-period">par mois</div>
                            <div class="subscription-option-features">
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Accès à plus de films
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Qualité HD
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> 2 écrans à la fois
                                </div>
                            </div>
                        </div>
                        
                        <!-- Option Premium -->
                        <div class="subscription-option {% if user.profile.subscription_type == 'premium' %}selected{% endif %}" data-plan="premium">
                            <div class="subscription-option-name">Premium</div>
                            <div class="subscription-option-price">$14.99</div>
                            <div class="subscription-option-period">par mois</div>
                            <div class="subscription-option-features">
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Accès à tous les films
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Qualité 4K + HDR
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> 4 écrans à la fois
                                </div>
                                <div class="subscription-option-feature">
                                    <i class="fas fa-check"></i> Téléchargements hors ligne
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <input type="hidden" id="subscription_type" name="subscription_type" value="{{ user.profile.subscription_type }}">
                    
                    <div class="error-message" id="subscription-error"></div>
                    <div class="success-message" id="subscription-success"></div>
                    
                    <button type="submit" class="profile-button" style="margin-top: 20px;">Mettre à jour l'abonnement</button>
                </form>
            </div>
            
            <!-- Onglet Historique -->
            <div id="history" class="tab-content">
                <h2 class="tab-title">Historique de visionnage</h2>
                
                <div class="history-list">
                    {% for history in watch_history %}
                    <div class="history-item">
                        <div class="history-thumbnail">
                            <img src="{{ history.movie.poster_url }}" alt="{{ history.movie.title }}">
                        </div>
                        <div class="history-details">
                            <div class="history-title">{{ history.movie.title }}</div>
                            <div class="history-meta">
                                <span>{{ history.watched_at|date:"d/m/Y H:i" }}</span>
                                <span>{{ history.progress }}%</span>
                            </div>
                        </div>
                        <div class="history-actions">
                            <button class="history-action" title="Continuer">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="history-action" title="Supprimer de l'historique">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    {% empty %}
                    <p>Vous n'avez pas encore regardé de films.</p>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Onglet Ma liste -->
            <div id="watchlist" class="tab-content">
                <h2 class="tab-title">Ma liste</h2>
                
                <div class="watchlist-grid">
                    {% for item in watchlist %}
                    <div class="watchlist-item">
                        <div class="watchlist-poster">
                            <img src="{{ item.movie.poster_url }}" alt="{{ item.movie.title }}">
                        </div>
                        <div class="watchlist-title">{{ item.movie.title }}</div>
                        <div class="watchlist-year">{{ item.movie.release_year }}</div>
                        <div class="watchlist-remove" data-id="{{ item.id }}">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    {% empty %}
                    <p>Vous n'avez pas encore ajouté de films à votre liste.</p>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Onglet Sécurité -->
            <div id="security" class="tab-content">
                <h2 class="tab-title">Sécurité</h2>
                
                <form id="password-form" class="profile-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="current_password">Mot de passe actuel</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="current_password" name="current_password" placeholder="Entrez votre mot de passe actuel">
                            <button type="button" class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="new_password">Nouveau mot de passe</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="new_password" name="new_password" placeholder="Entrez votre nouveau mot de passe">
                            <button type="button" class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password">Confirmer le mot de passe</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirmez votre nouveau mot de passe">
                            <button type="button" class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="error-message" id="password-error"></div>
                    <div class="success-message" id="password-success"></div>
                    
                    <button type="submit" class="profile-button">Changer le mot de passe</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des onglets
        const tabLinks = document.querySelectorAll('.profile-menu-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Supprimer la classe active de tous les liens
                tabLinks.forEach(l => l.classList.remove('active'));
                
                // Ajouter la classe active au lien cliqué
                this.classList.add('active');
                
                // Masquer tous les contenus d'onglet
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Afficher le contenu d'onglet correspondant
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Toggle password visibility
        const togglePasswordButtons = document.querySelectorAll('.toggle-password');
        
        togglePasswordButtons.forEach(button => {
            button.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const icon = this.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });
        
        // Sélection d'abonnement
        const subscriptionOptions = document.querySelectorAll('.subscription-option');
        const subscriptionTypeInput = document.getElementById('subscription_type');
        
        subscriptionOptions.forEach(option => {
            option.addEventListener('click', function() {
                // Supprimer la classe 'selected' de toutes les options
                subscriptionOptions.forEach(opt => opt.classList.remove('selected'));
                
                // Ajouter la classe 'selected' à l'option cliquée
                this.classList.add('selected');
                
                // Mettre à jour la valeur du champ caché
                subscriptionTypeInput.value = this.getAttribute('data-plan');
            });
        });
        
        // Formulaire de compte
        const accountForm = document.getElementById('account-form');
        if (accountForm) {
            accountForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const firstName = document.getElementById('first_name').value;
                const lastName = document.getElementById('last_name').value;
                const username = document.getElementById('username').value;
                const email = document.getElementById('email').value;
                const errorMessage = document.getElementById('account-error');
                const successMessage = document.getElementById('account-success');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Basic validation
                if (!username || !email) {
                    errorMessage.textContent = 'Le nom d\'utilisateur et l\'email sont requis.';
                    successMessage.textContent = '';
                    return;
                }
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    errorMessage.textContent = 'Veuillez entrer une adresse email valide.';
                    successMessage.textContent = '';
                    return;
                }
                
                // Clear previous messages
                errorMessage.textContent = '';
                successMessage.textContent = '';
                
                // Prepare data for API
                const formData = {
                    first_name: firstName,
                    last_name: lastName,
                    username: username,
                    email: email
                };
                
                // Send update request to API
                fetch('/api/users/profile/', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Une erreur est survenue');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    successMessage.textContent = 'Vos informations ont été mises à jour avec succès.';
                })
                .catch(error => {
                    errorMessage.textContent = error.message;
                });
            });
        }
        
        // Formulaire d'abonnement
        const subscriptionForm = document.getElementById('subscription-form');
        if (subscriptionForm) {
            subscriptionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const subscriptionType = document.getElementById('subscription_type').value;
                const errorMessage = document.getElementById('subscription-error');
                const successMessage = document.getElementById('subscription-success');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Clear previous messages
                errorMessage.textContent = '';
                successMessage.textContent = '';
                
                // Prepare data for API
                const formData = {
                    subscription_type: subscriptionType
                };
                
                // Send update request to API
                fetch('/api/users/subscription/', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Une erreur est survenue');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    successMessage.textContent = 'Votre abonnement a été mis à jour avec succès.';
                    
                    // Rediriger vers la page de profil après 2 secondes
                    setTimeout(function() {
                        window.location.reload();
                    }, 2000);
                })
                .catch(error => {
                    errorMessage.textContent = error.message;
                });
            });
        }
        
        // Formulaire de mot de passe
        const passwordForm = document.getElementById('password-form');
        if (passwordForm) {
            passwordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current_password').value;
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                const errorMessage = document.getElementById('password-error');
                const successMessage = document.getElementById('password-success');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Basic validation
                if (!currentPassword || !newPassword || !confirmPassword) {
                    errorMessage.textContent = 'Veuillez remplir tous les champs.';
                    successMessage.textContent = '';
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    errorMessage.textContent = 'Les mots de passe ne correspondent pas.';
                    successMessage.textContent = '';
                    return;
                }
                
                // Password strength validation
                if (newPassword.length < 8) {
                    errorMessage.textContent = 'Le mot de passe doit contenir au moins 8 caractères.';
                    successMessage.textContent = '';
                    return;
                }
                
                // Clear previous messages
                errorMessage.textContent = '';
                successMessage.textContent = '';
                
                // Prepare data for API
                const formData = {
                    current_password: currentPassword,
                    new_password: newPassword,
                    confirm_password: confirmPassword
                };
                
                // Send update request to API
                fetch('/api/users/change-password/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Une erreur est survenue');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    successMessage.textContent = 'Votre mot de passe a été changé avec succès.';
                    document.getElementById('current_password').value = '';
                    document.getElementById('new_password').value = '';
                    document.getElementById('confirm_password').value = '';
                })
                .catch(error => {
                    errorMessage.textContent = error.message;
                });
            });
        }
        
        // Supprimer de la liste de visionnage
        const watchlistRemoveButtons = document.querySelectorAll('.watchlist-remove');
        
        watchlistRemoveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const itemId = this.getAttribute('data-id');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                if (confirm('Êtes-vous sûr de vouloir supprimer ce film de votre liste ?')) {
                    fetch(`/api/users/watchlist/${itemId}/`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': csrfToken
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Une erreur est survenue');
                        }
                        
                        // Supprimer l'élément du DOM
                        this.closest('.watchlist-item').remove();
                    })
                    .catch(error => {
                        alert(error.message);
                    });
                }
            });
        });
    });
</script>
{% endblock %}